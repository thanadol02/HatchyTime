<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>StudyBoard ‚Äî Minimal Focus Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script>
    // ‡∏ï‡∏±‡πâ‡∏á‡∏ò‡∏µ‡∏°‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î CSS ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö plan (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏µ‡∏¢‡πå sb_theme ‡πÅ‡∏•‡∏∞ default ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö)
    (function(){
      const KEY = "sb_theme";
      try {
        var saved = localStorage.getItem(KEY) || (matchMedia && matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
        document.documentElement.setAttribute('data-theme', saved);
        localStorage.setItem(KEY, saved);
      } catch (e) {}
    })();
  </script>
  <!-- CSS ‡∏à‡∏≤‡∏Å static_folder="CSS" -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styledas.css') }}">
</head>

<body class="has-sidebar" data-page="dashboard">
  <!-- ========== Sidebar ========== -->
  <aside class="sidebar" aria-label="‡πÅ‡∏ñ‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á">
    <div class="sidebar-inner">
      <div class="sidebar-top">
        <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">‚ò∞</button>
        <div style="flex:1"></div>
        <button class="menu-btn theme-toggle" id="themeToggle" type="button" aria-pressed="false" aria-label="Switch color theme">
          <span class="icon" id="themeIcon">üåì</span>
          <span class="label" id="themeLabel">‡∏™‡∏•‡∏±‡∏ö‡∏ò‡∏µ‡∏°</span>
        </button>
      </div>

      <div class="sidebar-card" id="sidebarProfile" title="‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå">
        <div class="sidebar-profile">
          <img src="{{ url_for('static', filename='‡πÇ‡∏õ‡∏£.jpg') }}" class="avatar" alt="Profile">
          <div>
            <div class="profile-name">My Profile</div>
            <div class="profile-sub">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏∏‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‚ú®</div>
          </div>
          <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° Logout -->
          <button class="icon-btn logout-icon" id="logoutBtn" title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö" aria-label="Logout">üö™</button>
        </div>
      </div>

      <div class="sidebar-section-title">‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô</div>
      <ul class="menu">
        <li class="menu-item">
          <button class="menu-btn is-active" data-href="{{ url_for('dashboard') }}">
            <span class="icon">üè†</span><span class="label">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span>
          </button>
        </li>
        <li class="menu-item">
          <button class="menu-btn" data-href="{{ url_for('plan_page') }}">
            <span class="icon">üßæ</span><span class="label">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏î‡∏π‡πÅ‡∏ú‡∏ô</span>
          </button>
        </li>
      </ul>
    </div>
  </aside>

  <!-- ========== Main ========== -->
  <main class="main">
    <header class="topbar">
      <h1>Minimal Focus Dashboard</h1>
    </header>

    <!-- ========== Main + Right Sidebar Layout ========== -->
    <section class="dashboard-layout" aria-label="Dashboard main">

      <!-- LEFT: Upload + Reading Mode -->
      <div>
        <article class="card" style="max-width: 100%; margin: 0 auto; text-align:center; padding: 20px;">
          <div class="card-head"><h2>üìö ‡πÇ‡∏´‡∏°‡∏î‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2></div>

          <form method="post" action="{{ url_for('dashboard') }}" enctype="multipart/form-data" style="margin: 20px auto; max-width: 520px;">
            <input type="file" name="file" class="form-control mb-2" />
            <div class="stack" style="gap: 8px; align-items: center;">
              <button type="submit" class="btn success">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î</button>
              <small class="hint">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö .txt, .csv, .xls, .xlsx, .pdf</small>
            </div>
          </form>

          {% if download_url or pdf_url %}
          <div class="opt" style="display:flex; gap:8px; align-items:center; justify-content:flex-end; margin-top:8px;">
            <label for="fontSizeSel">‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£:</label>
            <select id="fontSizeSel">
              <option value="18px">‡πÄ‡∏•‡πá‡∏Å</option>
              <option value="20px" selected>‡∏Å‡∏•‡∏≤‡∏á</option>
              <option value="24px">‡πÉ‡∏´‡∏ç‡πà</option>
              <option value="28px">‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏Å</option>
            </select>
            {% if download_url %}
              <a class="btn tiny" href="{{ download_url }}">‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</a>
            {% endif %}
          </div>
          {% endif %}

          {% if reading_text %}
            <div id="readingBox" class="reading-box" style="text-align:left; margin-top:12px;">
              <pre id="readingText" class="reading-pre">{{ reading_text }}</pre>
            </div>
          {% endif %}

          {% if pdf_url %}
            <h4 style="margin-top:16px; text-align:left;">üìÑ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á PDF</h4>
            <div style="border:1px solid var(--soft, #eef2f7); border-radius:12px; overflow:hidden;">
              <iframe src="{{ pdf_url }}" style="width:100%; height:600px; border:0;" title="PDF preview"></iframe>
            </div>
          {% endif %}
        </article>
      </div>

      <!-- RIGHT: Focus & widgets as sidebar -->
      <aside class="right-stick">
        <article class="card">
          <div class="card-head"><h2>ü¶ú Focus Mode</h2></div>

          <div class="opt" id="modeSwitch">
            <label style="min-width: 92px;">‡πÇ‡∏´‡∏°‡∏î:</label>
            <div class="seg">
              <button type="button" class="btn tiny is-active" data-mode="timer" id="modeTimerBtn">‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥</button>
              <button type="button" class="btn tiny" data-mode="pomo" id="modePomoBtn">Pomodoro</button>
            </div>
            <select id="pomoPreset" class="hidden">
              <option value="25-5-15-4">25 ‡πÇ‡∏ü‡∏Å‡∏±‡∏™ / 5 ‡∏û‡∏±‡∏Å‡∏™‡∏±‡πâ‡∏ô / ‡∏û‡∏±‡∏Å‡∏¢‡∏≤‡∏ß 15 ‡∏ó‡∏∏‡∏Å 4 ‡∏£‡∏≠‡∏ö</option>
              <option value="50-10-20-3">50 ‡πÇ‡∏ü‡∏Å‡∏±‡∏™ / 10 ‡∏û‡∏±‡∏Å‡∏™‡∏±‡πâ‡∏ô / ‡∏û‡∏±‡∏Å‡∏¢‡∏≤‡∏ß 20 ‡∏ó‡∏∏‡∏Å 3 ‡∏£‡∏≠‡∏ö</option>
            </select>
            <span class="hint" id="modeHint">‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥</span>
          </div>

          <div class="opt">
            <label for="timeSelect">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤:</label>
            <select id="timeSelect">
              <option value="30">30 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
              <option value="60">1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
              <option value="90">1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á 30 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
              <option value="120">2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
              <option value="custom">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏≠‡∏á...</option>
            </select>
          </div>

          <div class="opt" id="pomoControls">
            <label><input type="checkbox" id="pomoEnable" /> ‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î Pomodoro</label>
            <button class="btn tiny" type="button" id="pomoSettings">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
            <span class="hint" id="pomoStatus">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°: ‡πÇ‡∏ü‡∏Å‡∏±‡∏™ 25 ‡∏ô‡∏≤‡∏ó‡∏µ</span>
          </div>

          <div class="opt">
            <label for="subjectSelect">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤:</label>
            <select id="subjectSelect"></select>
            <input type="text" id="newSubject" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤‡πÉ‡∏´‡∏°‡πà..." />
            <button class="btn tiny success" type="button" id="addSubjectBtn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
          </div>

          <div class="timer">
            <div id="display" class="timer-display" aria-live="polite">00:00</div>
            <div class="timer-actions">
              <button class="btn success" type="button" id="startBtn">‚ñ∂Ô∏è Start</button>
              <button class="btn warning" type="button" id="pauseBtn">‚è∏Ô∏è Pause</button>
              <button class="btn danger" type="button" id="stopBtn">‚èπÔ∏è Stop</button>
            </div>
          </div>

          <div class="quote-box" id="quote">‚ÄúFocus is the key to productivity. Stay committed!‚Äù üí™</div>

          <div class="stage">
            <div class="video-wrap" aria-label="Camera preview">
              <video id="cameraFeed" autoplay playsinline muted></video>
              <div class="status-badge" id="eyeStatus">üëÄ ‡∏£‡∏≠‡∏à‡∏±‡∏ö‡∏™‡∏≤‡∏¢‡∏ï‡∏≤...</div>
            </div>
            <div class="pet">
              <div class="bird" id="bird">ü¶ú</div>
              <div class="mood" id="mood">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡∏Å‡πá‡∏Å‡∏î START</div>
              <div class="bar-wrap"><div class="bar" id="progressBar"></div></div>
              <div class="hint">Progress toward daily goal (2h)</div>
            </div>
          </div>

          <div class="log">
            <h3>üìä ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏∞‡∏™‡∏°‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤</h3>
            <ul id="subjectLog"></ul>
          </div>
        </article>
      </aside>
    </section>
  </main>

  <!-- ========== Scripts ========== -->
  <script>
    // Toggle Sidebar ‚Äî ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô plan (‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà body.sidebar-collapsed)
    (function(){
      const toggleBtn = document.getElementById('sidebarToggle');
      toggleBtn?.addEventListener('click', () => {
        document.body.classList.toggle('sidebar-collapsed');
      });
    })();

    // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á‡∏ú‡πà‡∏≤‡∏ô Flask route
    (function(){
      const card = document.getElementById('sidebarProfile');
      card?.addEventListener('click', (e)=>{
        e.preventDefault();
        e.stopPropagation();
        window.location.href = "{{ url_for('user_page') }}";
      });
    })();

    // ‡πÄ‡∏û‡∏¥‡πà‡∏° Logout ‡πÉ‡∏ô Sidebar (‡πÄ‡∏Å‡πá‡∏ö‡∏ò‡∏µ‡∏° sb_theme ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏•‡πâ‡∏≤‡∏á storage)
    (function () {
      const btn = document.getElementById("logoutBtn");
      btn?.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        try {
          const theme = localStorage.getItem("sb_theme") || document.documentElement.getAttribute("data-theme");
          localStorage.clear(); sessionStorage.clear();
          if (theme) localStorage.setItem("sb_theme", theme);
        } catch (e) {}
        window.location.href = "{{ url_for('login_page') }}";
      });
    })();

    // Theme toggle ‚Äî ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô plan.html ‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£
    (function(){
      const THEME_KEY = "sb_theme";
      const themeToggle = document.getElementById("themeToggle");
      const themeIcon   = document.getElementById("themeIcon");
      const themeLabel  = document.getElementById("themeLabel");

      const preferred = localStorage.getItem(THEME_KEY)
        || (matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");

      const apply = (t) => {
        document.documentElement.setAttribute("data-theme", t);
        const isDark = t === "dark";
        themeToggle?.setAttribute("aria-pressed", String(isDark));
        if (themeIcon)  themeIcon.textContent  = isDark ? "üåô" : "üåû";
        if (themeLabel) themeLabel.textContent = isDark ? "‡∏ò‡∏µ‡∏°‡∏™‡∏ß‡πà‡∏≤‡∏á" : "‡∏™‡∏•‡∏±‡∏ö‡∏ò‡∏µ‡∏°";
      };

      apply(preferred);

      themeToggle?.addEventListener("click", () => {
        const cur  = document.documentElement.getAttribute("data-theme") || "light";
        const next = (cur === "light") ? "dark" : "light";
        localStorage.setItem(THEME_KEY, next);
        apply(next);
      });
    })();

    // ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠
    (function(){
      const sel = document.getElementById('fontSizeSel');
      const txt = document.getElementById('readingText');
      if (sel && txt) {
        sel.addEventListener('change', () => {
          txt.style.fontSize = sel.value;
        });
      }
    })();

    // Sidebar: ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° + ‡∏ó‡∏≥ active ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (normalize path)
    (function(){
      document.addEventListener('click', (e)=>{
        const btn = e.target.closest('.menu-btn[data-href]');
        if(!btn) return;
        const href = btn.getAttribute('data-href');
        if (href) window.location.href = href;
      });

      function normPath(p){
        try { return new URL(p, location.origin).pathname.replace(/\/+$/,''); }
        catch { return String(p||'').replace(/^[^/]*(?=\/)/,'').replace(/\/+$/,''); }
      }
      const current = normPath(location.pathname);
      document.querySelectorAll('.menu-btn[data-href]').forEach(btn=>{
        const href = btn.getAttribute('data-href') || '';
        btn.classList.toggle('active', normPath(href) === current);
      });
    })();
  </script>

  <!-- Libs ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- ‚úÖ ‡πÉ‡∏™‡πà MediaPipe ‡∏Å‡πà‡∏≠‡∏ô dashboard.js -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

  <!-- ‚úÖ dashboard.js ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏´‡∏•‡∏±‡∏á MediaPipe -->
  <script src="{{ url_for('serve_js', filename='dashboard.js') }}" defer></script>
</body>
</html>
</html>
